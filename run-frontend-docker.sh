#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ Docker (–±–µ–∑ docker-compose)

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ Docker..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ Docker
if ! docker info > /dev/null 2>&1; then
    echo "‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
cd "$(dirname "$0")/frontend/frontend/front"

# –ò–º—è –æ–±—Ä–∞–∑–∞
IMAGE_NAME="teamup-frontend"
CONTAINER_NAME="teamup-frontend"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)..."
docker stop $CONTAINER_NAME 2>/dev/null || true
docker rm $CONTAINER_NAME 2>/dev/null || true

# –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑
echo "üì¶ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞..."
docker build -t $IMAGE_NAME .

# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
echo "üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5174..."
docker run -d \
  --name $CONTAINER_NAME \
  -p 5174:5174 \
  -v "$(pwd):/app" \
  -v /app/node_modules \
  $IMAGE_NAME

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
if [ $? -eq 0 ]; then
    echo "‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:5174"
    echo "üìã –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤: docker logs -f $CONTAINER_NAME"
    echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: docker stop $CONTAINER_NAME"
    echo "üóëÔ∏è  –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è: docker rm $CONTAINER_NAME"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"
    exit 1
fi


